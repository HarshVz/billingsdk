{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "usage-table",
  "type": "registry:block",
  "title": "Usage Table",
  "description": "A usage table component with resource consumption breakdown",
  "registryDependencies": [
    "table",
    "card",
    "utils"
  ],
  "files": [
    {
      "path": "src/registry/billingsdk/usage-table.tsx",
      "content": "\"use client\";\r\nimport React, { useCallback } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardDescription,\r\n  CardHeader,\r\n  CardTitle,\r\n} from \"@/components/ui/card\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableCaption,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/components/ui/table\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Download } from \"lucide-react\";\r\n\r\nexport interface UsageItem {\r\n  model: string;\r\n  inputWithCache: number;\r\n  inputWithoutCache: number;\r\n  cacheRead: number;\r\n  output: number;\r\n  totalTokens: number;\r\n  apiCost?: number;\r\n  costToYou?: number;\r\n}\r\n\r\ninterface UsageTableProps {\r\n  className?: string;\r\n  title?: string;\r\n  description?: string;\r\n  usageHistory: UsageItem[];\r\n  showTotal?: boolean;\r\n}\r\n\r\nexport function UsageTable({\r\n  className,\r\n  title,\r\n  description,\r\n  usageHistory,\r\n  showTotal = true, // Default to true\r\n}: UsageTableProps) {\r\n  const totalRow = showTotal\r\n    ? usageHistory.reduce(\r\n        (acc, item) => ({\r\n          inputWithCache: acc.inputWithCache + item.inputWithCache,\r\n          inputWithoutCache: acc.inputWithoutCache + item.inputWithoutCache,\r\n          cacheRead: acc.cacheRead + item.cacheRead,\r\n          output: acc.output + item.output,\r\n          totalTokens: acc.totalTokens + item.totalTokens,\r\n          apiCost: acc.apiCost + (item.apiCost || 0),\r\n          costToYou: acc.costToYou + (item.costToYou || 0),\r\n        }),\r\n        {\r\n          inputWithCache: 0,\r\n          inputWithoutCache: 0,\r\n          cacheRead: 0,\r\n          output: 0,\r\n          totalTokens: 0,\r\n          apiCost: 0,\r\n          costToYou: 0,\r\n        },\r\n      )\r\n    : null;\r\n\r\n  const formatNumber = (num: number) => {\r\n    return new Intl.NumberFormat().format(num);\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return `$${amount.toFixed(2)}`;\r\n  };\r\n  const hasApiCost = usageHistory.some(\r\n    (item) => item.apiCost !== undefined && item.apiCost !== null,\r\n  );\r\n  const hasCostToYou = usageHistory.some(\r\n    (item) => item.costToYou !== undefined && item.costToYou !== null,\r\n  );\r\n\r\n  const exportColumns = [\r\n    { key: \"model\", label: \"Model\" },\r\n    { key: \"inputWithCache\", label: \"Input (w/ Cache)\" },\r\n    { key: \"inputWithoutCache\", label: \"Input (w/o Cache)\" },\r\n    { key: \"cacheRead\", label: \"Cache Read\" },\r\n    { key: \"output\", label: \"Output\" },\r\n    { key: \"totalTokens\", label: \"Total Tokens\" },\r\n    { key: \"apiCost\", label: \"API Cost\" },\r\n    { key: \"costToYou\", label: \"Cost to You\" },\r\n  ] as const;\r\n  // --- CSV EXPORT LOGIC ---\r\n  const exportToCsv = useCallback(() => {\r\n    if (!usageHistory || usageHistory.length === 0) {\r\n      console.warn(\"No data to export.\");\r\n      return;\r\n    }\r\n    // 1. Filter columns to match what is displayed\r\n    const columnsToExport = exportColumns.filter((col) => {\r\n      if (col.key === \"apiCost\") return hasApiCost;\r\n      if (col.key === \"costToYou\") return hasCostToYou;\r\n      return true;\r\n    });\r\n\r\n    // 2. Generate Header Row using display labels\r\n    const headerRow = columnsToExport.map((col) => `\"${col.label}\"`).join(\",\");\r\n\r\n    // 3. Helper to format a single data item into a CSV row\r\n    const getCsvRow = (item: UsageItem & { model: string }): string => {\r\n      return columnsToExport\r\n        .map((col) => {\r\n          const key = col.key as keyof UsageItem;\r\n          const value = item[key];\r\n\r\n          let formattedValue: string;\r\n\r\n          if (key === \"model\") {\r\n            formattedValue = item.model;\r\n          } else if (key === \"apiCost\" || key === \"costToYou\") {\r\n            // Apply currency formatting\r\n            formattedValue = formatCurrency(Number(value ?? 0));\r\n          } else {\r\n            formattedValue = formatNumber(Number(value ?? 0)); // Apply number formatting for tokens\r\n          }\r\n\r\n          // Escape double quotes and wrap in quotes for robust CSV\r\n          const escapedValue = String(formattedValue).replace(/\"/g, '\"\"');\r\n          return `\"${escapedValue}\"`;\r\n        })\r\n        .join(\",\");\r\n    };\r\n\r\n    // 4. Map usage history rows\r\n    let allRows = usageHistory.map((item) => getCsvRow(item));\r\n\r\n    // 5. Conditionally add the total row\r\n    if (showTotal && totalRow) {\r\n      const totalItem = {\r\n        ...totalRow,\r\n        // Override 'model' key for the Total row label\r\n        model: \"Total\",\r\n      } as UsageItem;\r\n\r\n      allRows.push(getCsvRow(totalItem));\r\n    }\r\n    // 6. Combine all content and trigger download (BOM + CRLF for Excel)\r\n    const csvContent = [headerRow, ...allRows].join(\"\\r\\n\");\r\n    const blob = new Blob([\"\\uFEFF\", csvContent], {\r\n      type: \"text/csv;charset=utf-8;\",\r\n    });\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    const link = document.createElement(\"a\");\r\n    link.setAttribute(\"href\", url);\r\n    link.setAttribute(\"download\", \"usage_summary.csv\");\r\n\r\n    document.body.appendChild(link);\r\n    try {\r\n      link.click();\r\n    } finally {\r\n      document.body.removeChild(link);\r\n      // Slight delay ensures some browsers finish navigation before revoking\r\n      setTimeout(() => URL.revokeObjectURL(url), 0);\r\n    }\r\n  }, [\r\n    usageHistory,\r\n    totalRow,\r\n    showTotal,\r\n    hasApiCost,\r\n    hasCostToYou,\r\n    formatNumber,\r\n    formatCurrency,\r\n  ]);\r\n  // --- END CSV EXPORT LOGIC ---\r\n  // Calculate total row if showTotal is true\r\n  return (\r\n    <Card className={cn(\"w-full\", className)}>\r\n      <CardHeader className=\"flex flex-row items-start justify-between space-y-0\">\r\n        <div className=\"space-y-1\">\r\n          {title && <CardTitle>{title}</CardTitle>}\r\n          {description && <CardDescription>{description}</CardDescription>}\r\n        </div>\r\n        {/* Export Button on the top right */}\r\n        {usageHistory.length > 0 && (\r\n          <Button\r\n            onClick={exportToCsv}\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"ml-4 h-8\"\r\n          >\r\n            <Download className=\"mr-2 h-4 w-4\" />\r\n            Export to CSV\r\n          </Button>\r\n        )}\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div className=\"overflow-x-auto rounded-md border\">\r\n          <Table>\r\n            <TableCaption className=\"sr-only\">\r\n              Model usage summary with token counts and costs\r\n            </TableCaption>\r\n            <TableHeader>\r\n              <TableRow>\r\n                <TableHead className=\"w-[140px]\">Model</TableHead>\r\n                <TableHead className=\"text-right\">\r\n                  <span className=\"hidden sm:inline\">Input (w/ Cache)</span>\r\n                  <span className=\"sm:hidden\">w/ Cache</span>\r\n                </TableHead>\r\n                <TableHead className=\"text-right\">\r\n                  <span className=\"hidden sm:inline\">Input (w/o Cache)</span>\r\n                  <span className=\"sm:hidden\">w/o Cache</span>\r\n                </TableHead>\r\n                <TableHead className=\"text-right\">\r\n                  <span className=\"hidden sm:inline\">Cache Read</span>\r\n                  <span className=\"sm:hidden\">Cache</span>\r\n                </TableHead>\r\n                <TableHead className=\"text-right\">Output</TableHead>\r\n                <TableHead className=\"text-right\">\r\n                  <span className=\"hidden sm:inline\">Total Tokens</span>\r\n                  <span className=\"sm:hidden\">Total</span>\r\n                </TableHead>\r\n                {hasApiCost && (\r\n                  <TableHead className=\"text-right\">\r\n                    <span className=\"hidden sm:inline\">API Cost</span>\r\n                    <span className=\"sm:hidden\">API</span>\r\n                  </TableHead>\r\n                )}\r\n                {hasCostToYou && (\r\n                  <TableHead className=\"text-right\">\r\n                    <span className=\"hidden sm:inline\">Cost to You</span>\r\n                    <span className=\"sm:hidden\">Cost</span>\r\n                  </TableHead>\r\n                )}\r\n              </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n              {usageHistory.length === 0 && (\r\n                <TableRow>\r\n                  <TableCell\r\n                    colSpan={8}\r\n                    className=\"text-muted-foreground h-24 text-center\"\r\n                  >\r\n                    No usage data available\r\n                  </TableCell>\r\n                </TableRow>\r\n              )}\r\n              {usageHistory.map((item, index) => (\r\n                <TableRow key={item.model || index}>\r\n                  <TableCell className=\"font-medium\">{item.model}</TableCell>\r\n                  <TableCell className=\"text-right\">\r\n                    {formatNumber(item.inputWithCache)}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right\">\r\n                    {formatNumber(item.inputWithoutCache)}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right\">\r\n                    {formatNumber(item.cacheRead)}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right\">\r\n                    {formatNumber(item.output)}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right\">\r\n                    {formatNumber(item.totalTokens)}\r\n                  </TableCell>\r\n                  {hasApiCost && (\r\n                    <TableCell className=\"text-right\">\r\n                      {formatCurrency(item.apiCost || 0)}\r\n                    </TableCell>\r\n                  )}\r\n                  {hasCostToYou && (\r\n                    <TableCell className=\"text-right\">\r\n                      {formatCurrency(item.costToYou || 0)}\r\n                    </TableCell>\r\n                  )}\r\n                </TableRow>\r\n              ))}\r\n              {showTotal && totalRow && (\r\n                <TableRow className=\"bg-muted/50 hover:bg-muted/50\">\r\n                  <TableCell className=\"font-semibold\">Total</TableCell>\r\n                  <TableCell className=\"text-right font-semibold\">\r\n                    {formatNumber(totalRow.inputWithCache)}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right font-semibold\">\r\n                    {formatNumber(totalRow.inputWithoutCache)}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right font-semibold\">\r\n                    {formatNumber(totalRow.cacheRead)}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right font-semibold\">\r\n                    {formatNumber(totalRow.output)}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right font-semibold\">\r\n                    {formatNumber(totalRow.totalTokens)}\r\n                  </TableCell>\r\n                  {hasApiCost && (\r\n                    <TableCell className=\"text-right font-semibold\">\r\n                      {formatCurrency(totalRow.apiCost || 0)}\r\n                    </TableCell>\r\n                  )}\r\n                  {hasCostToYou && (\r\n                    <TableCell className=\"text-right font-semibold\">\r\n                      {formatCurrency(totalRow.costToYou || 0)}\r\n                    </TableCell>\r\n                  )}\r\n                </TableRow>\r\n              )}\r\n            </TableBody>\r\n          </Table>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n",
      "type": "registry:component",
      "target": "components/billingsdk/usage-table.tsx"
    },
    {
      "path": "src/registry/billingsdk/demo/usage-table-demo.tsx",
      "content": "import { UsageTable, type UsageItem } from \"@/registry/billingsdk/usage-table\";\r\n\r\nexport default function UsageTableDemo() {\r\n  const usageHistory: UsageItem[] = [\r\n    {\r\n      model: \"gpt-5\",\r\n      inputWithCache: 0,\r\n      inputWithoutCache: 518131,\r\n      cacheRead: 1646080,\r\n      output: 103271,\r\n      totalTokens: 2267482,\r\n    },\r\n    {\r\n      model: \"claude-3.5-sonnet\",\r\n      inputWithCache: 176177,\r\n      inputWithoutCache: 28413,\r\n      cacheRead: 434612,\r\n      output: 8326,\r\n      totalTokens: 647528,\r\n      costToYou: 1.0,\r\n    },\r\n    {\r\n      model: \"gemini-2.0-flash-exp\",\r\n      inputWithCache: 176100,\r\n      inputWithoutCache: 28432,\r\n      cacheRead: 434612,\r\n      output: 8326,\r\n      totalTokens: 647528,\r\n      apiCost: 1,\r\n      costToYou: 0,\r\n    },\r\n    {\r\n      model: \"gemini-2.5-pro\",\r\n      inputWithCache: 176177,\r\n      inputWithoutCache: 28413,\r\n      cacheRead: 434612,\r\n      output: 7000,\r\n      totalTokens: 647528,\r\n      apiCost: 1,\r\n      costToYou: 0,\r\n    },\r\n    {\r\n      model: \"claude-4-sonnet\",\r\n      inputWithCache: 68415,\r\n      inputWithoutCache: 902,\r\n      cacheRead: 864450,\r\n      output: 12769,\r\n      totalTokens: 946536,\r\n      apiCost: 0.71,\r\n      costToYou: 0.71,\r\n    },\r\n    {\r\n      model: \"claude-3.7-sonnet\",\r\n      inputWithCache: 68415,\r\n      inputWithoutCache: 902,\r\n      cacheRead: 864450,\r\n      output: 12769,\r\n      totalTokens: 946536,\r\n      apiCost: 0.71,\r\n    },\r\n    {\r\n      model: \"auto\",\r\n      inputWithCache: 84551,\r\n      inputWithoutCache: 0,\r\n      cacheRead: 284876,\r\n      output: 9458,\r\n      totalTokens: 378885,\r\n      apiCost: 0.23,\r\n      costToYou: 0,\r\n    },\r\n    {\r\n      model: \"sonic\",\r\n      inputWithCache: 0,\r\n      inputWithoutCache: 149484,\r\n      cacheRead: 4354855,\r\n      output: 23569,\r\n      totalTokens: 4527908,\r\n      costToYou: 2,\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <UsageTable\r\n      title=\"Usage Summary\"\r\n      usageHistory={usageHistory}\r\n      showTotal={true}\r\n      description=\"Per-model LLM usage with token counts, cache reads, and API cost.\"\r\n    />\r\n  );\r\n}\r\n",
      "type": "registry:component",
      "target": "components/usage-table-demo.tsx"
    }
  ]
}